<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Spotify Auth – Start</title>
<meta name="robots" content="noindex,nofollow">
<meta http-equiv="Content-Security-Policy"
      content="default-src 'self';
               connect-src 'self' https://accounts.spotify.com;
               style-src 'self' 'unsafe-inline';
               script-src 'self' 'unsafe-inline';
               frame-ancestors 'none';
               base-uri 'self';">
<style>body{font-family:system-ui;-webkit-font-smoothing:antialiased;padding:24px}code{background:#f3f3f3;padding:2px 6px;border-radius:6px}</style>
</head>
<body>
<h1>Connect with Spotify</h1>
<p>公式ドメインへリダイレクトします。</p>
<script>
const CLIENT_ID="1fd6350fcf4945a0b3ddffa2d5730d4e";
const REDIRECT_URI="https://npr2025.github.io/spotify-auth/callback.html";
const SCOPE=[
  "playlist-modify-public",
  "playlist-modify-private",
].join(' ');
function b64url(a){return btoa(String.fromCharCode(...new Uint8Array(a))).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');}
async function sha256(t){const e=new TextEncoder().encode(t);return await crypto.subtle.digest("SHA-256",e);}
(async()=>{
  const ver=Array.from(crypto.getRandomValues(new Uint8Array(64))).map(b=>('0'+(b&0xff).toString(16)).slice(-2)).join('');
  const chal=b64url(await sha256(ver));
  sessionStorage.setItem('sp_code_verifier',ver);
  const params=new URLSearchParams({
    response_type:'code',
    client_id:CLIENT_ID,
    redirect_uri:REDIRECT_URI,
    code_challenge_method:'S256',
    code_challenge:chal,
    scope:SCOPE,
    state:Math.random().toString(36).slice(2),
    show_dialog:'false'
  });
  location.href=`https://accounts.spotify.com/authorize?${params.toString()}`;
})();
</script>
</body>
</html>
