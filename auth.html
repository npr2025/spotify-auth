<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Spotify Auth — TDCS Primary Seek</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial, 'Noto Sans JP'; margin: 2rem; }
    .card { border: 1px solid #ddd; border-radius: 10px; padding: 1.2rem; max-width: 720px; }
    button { padding: .7rem 1.1rem; border-radius: 8px; border: 1px solid #999; background: #111; color: #fff; cursor: pointer; }
    code { background: #f6f6f6; padding: .15rem .35rem; border-radius: 4px; }
    .muted { color: #666; }
  </style>
</head>
<body>
  <div class="card">
    <h1>Spotify 認証（Implicit Grant）</h1>
    <p class="muted">Client ID: <code>378ef0f44b36499abd10d118ddbddc98</code><br/>Redirect URI: <code>https://npr2025.github.io/spotify-auth/callback.html</code></p>
    <p>「接続」ボタンでSpotifyに遷移し、戻ってきたらトークンが保存されます（ブラウザの <code>localStorage</code>）。</p>
    <p><button id="connectBtn">Spotifyに接続</button> <a href="./index.html" style="margin-left: 1rem;">監査ツールへ戻る</a></p>
    <p><button id="clearBtn" style="background:#eee;color:#111;">保存トークン削除</button> <span id="status" class="muted"></span></p>
  </div>
<script>
const CLIENT_ID = "378ef0f44b36499abd10d118ddbddc98";
const REDIRECT_URI = "https://npr2025.github.io/spotify-auth/callback.html";
function buildAuthUrl() {
  const state = Math.random().toString(36).slice(2);
  localStorage.setItem('sp_state', state);
  const scope = encodeURIComponent(''); // public metadata only
  const url = "https://accounts.spotify.com/authorize"
    + "?client_id=" + encodeURIComponent(CLIENT_ID)
    + "&response_type=token"
    + "&redirect_uri=" + encodeURIComponent(REDIRECT_URI)
    + "&state=" + state
    + "&scope=" + scope
    + "&show_dialog=true";
  return url;
}
document.getElementById('connectBtn').addEventListener('click', () => {
  window.location.href = buildAuthUrl();
});
document.getElementById('clearBtn').addEventListener('click', () => {
  localStorage.removeItem('sp_token');
  document.getElementById('status').textContent = '削除しました。';
});
</script>
</body>
</html>
