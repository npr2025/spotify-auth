<!doctype html><meta charset="utf-8">
<title>Spotify PKCE Auth</title>
<button id="login">Spotify にログイン</button>
<script>
const CLIENT_ID="1fd6350fcf4945a0b3ddffa2d5730d4e";
const REDIRECT_URI="https://npr2025.github.io/spotify-auth/callback.html";
const SCOPE="";
function b64url(b){return btoa(String.fromCharCode(...new Uint8Array(b))).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");}
async function sha256(t){return await crypto.subtle.digest("SHA-256", new TextEncoder().encode(t));}
function rand(n=64){const a=new Uint8Array(n);crypto.getRandomValues(a);return b64url(a);}
document.getElementById("login").onclick = async () => {
  const verifier=rand(64), challenge=b64url(await sha256(verifier)), state=rand(32);
  sessionStorage.setItem("pkce_verifier",verifier);
  sessionStorage.setItem("pkce_state",state);
  const p = new URLSearchParams({
    response_type:"code", client_id:CLIENT_ID, redirect_uri:REDIRECT_URI,
    code_challenge_method:"S256", code_challenge:challenge, state, scope:SCOPE
  });
  location.href = "https://accounts.spotify.com/authorize?" + p.toString();
};
</script>
