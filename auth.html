<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Editions Builder â€” Files Only (CSV/XLSX)</title>
<style>
  :root{--bg:#0b1220;--fg:#cfe3ff}
  body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;max-width:1100px;margin:32px auto;padding:0 12px}
  h1{margin:0 0 8px}
  fieldset{border:1px solid #ddd;border-radius:10px;padding:14px;margin:12px 0}
  legend{padding:0 6px}
  label{display:block;margin:6px 0}
  input[type="text"],input[type="number"]{width:100%;max-width:720px;padding:6px 8px;border:1px solid #ccc;border-radius:6px}
  input[type="file"]{margin:4px 0}
  button{padding:9px 12px;border:1px solid #bbb;border-radius:8px;background:#fff;cursor:pointer;margin:6px 8px 0 0}
  button:disabled{opacity:.5;cursor:not-allowed}
  .row{display:flex;gap:14px;flex-wrap:wrap}
  #log{white-space:pre-wrap;background:var(--bg);color:var(--fg);padding:12px;border-radius:8px;min-height:180px}
  small.hint{color:#666}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
</style>
<!-- CSV/XLSX ãƒ‘ãƒ¼ã‚µï¼ˆCDNï¼‰ -->
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
<h1>Editions Builder â€” Files Only</h1>
<p id="status">æœªæ¥ç¶š</p>
<div class="row">
  <button id="btnConnect">Spotifyã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³</button>
  <button id="btnReset">åˆæœŸåŒ–ï¼ˆä¿å­˜ãƒˆãƒ¼ã‚¯ãƒ³å‰Šé™¤ï¼‰</button>
  <button id="btnCheck">æ¥ç¶šãƒã‚§ãƒƒã‚¯</button>
</div>

<fieldset>
  <legend>è¨­å®š</legend>
  <label>APIé–“éš”(ms) <input id="gap" type="number" value="900"></label>
  <div class="grid2">
    <label>UKãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ URL/ID <input id="plUK" type="text" placeholder="https://open.spotify.com/playlist/..." value="https://open.spotify.com/playlist/1zqDXSgnbc87v4BxbHxtKK"></label>
    <label>USãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ URL/ID <input id="plUS" type="text" placeholder="https://open.spotify.com/playlist/..." value="https://open.spotify.com/playlist/2oeS8QglwS4hLtLuqvPZgH"></label>
    <label>EUãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ URL/ID <input id="plEU" type="text" placeholder="https://open.spotify.com/playlist/..." value="https://open.spotify.com/playlist/2JWHMN3yxLI5S4XFdDZbwt"></label>
    <label>WORLDãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆ URL/ID <input id="plWORLD" type="text" placeholder="https://open.spotify.com/playlist/..." value="https://open.spotify.com/playlist/4SCclM9zLNuSPOmqORdVN8"></label>
  </div>
  <div class="grid2">
    <label>Balancedã‚¿ãƒ¼ã‚²ãƒƒãƒˆï¼ˆä¸¦ã¹æ›¿ãˆæ¯é›†å›£ï¼‰<input id="balancedN" type="number" value="150"></label>
    <label>æœ€çµ‚å‡ºåŠ›æ›²æ•°ï¼ˆå„ã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ï¼‰<input id="finalN" type="number" value="130"></label>
  </div>
  <div class="grid2">
    <label>äººæ°—ã®é‡ã¿ï¼ˆSaveRate vs Playsï¼‰<input id="wPopularity" type="number" step="0.01" value="0.55"></label>
    <label>æ–°ã—ã•ã®é‡ã¿ï¼ˆ24h/7d/28d = 0.5/0.3/0.2ï¼‰<input id="wNewness" type="number" step="0.01" value="0.45" disabled></label>
  </div>
  <small class="hint">â€» ç·åˆ = 0.55 Ã— ä¿å­˜ç‡(24h/7d/28d=0.5/0.3/0.2) + 0.45 Ã— å†ç”Ÿæ•°(åŒã‚¦ã‚§ã‚¤ãƒˆ)ã€‚</small>
</fieldset>

<fieldset>
  <legend>ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›ï¼ˆ**ã‚½ãƒ¼ã‚¹CSVã ã‘ã‚’æ¯é›†å›£** / **åˆ†æãƒ‡ãƒ¼ã‚¿ã§é¸æ›²**ï¼‰</legend>
  <label>ã‚½ãƒ¼ã‚¹CSVï¼ˆä¾‹ï¼šPropagandaã‚½ãƒ¼ã‚¹.csvï¼‰<input id="fileSource" type="file" accept=".csv"></label>
  <label>åˆ†æãƒ‡ãƒ¼ã‚¿ï¼ˆExcel .xlsx / CSVï¼‰<input id="fileAnalytics" type="file" accept=".xlsx,.csv"></label>
  <div class="row">
    <button id="btnPreview" disabled>ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆä¸Šä½20ï¼‰</button>
    <button id="btnRun" disabled>ãƒ•ã‚¡ã‚¤ãƒ«ã ã‘ã§4ã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã¸ä¸Šæ›¸ã</button>
  </div>
</fieldset>

<fieldset>
  <legend>ãƒ­ã‚°</legend>
  <pre id="log">Bootingâ€¦</pre>
</fieldset>

<script>
/*** ã‚ãªãŸã®ç’°å¢ƒã«åˆã‚ã›ã¦ ***/
const CLIENT_ID   = "YOUR_SPOTIFY_CLIENT_ID";
const REDIRECT_URI= location.origin + location.pathname.replace(/auth\.html$/,"callback.html");
const SCOPES     = "playlist-modify-public playlist-modify-private ugc-image-upload";

const LS = {
  acc: "sp_access_token",
  ref: "sp_refresh_token",
  exp: "sp_token_exp", // epoch ms
  ver: "sp_code_verifier",
};

const $ = (id)=>document.getElementById(id);
const log = (s)=>{ const el=$("log"); el.textContent += (el.textContent? "\n":"")+ s; el.scrollTop = el.scrollHeight; };
const clearLog = ()=>{ $("log").textContent=""; };

function isAuthed(){
  const t = localStorage.getItem(LS.acc);
  const exp = +localStorage.getItem(LS.exp||0);
  return !!t && Date.now() < exp - 5000;
}

function setStatus(){
  $("status").textContent = isAuthed()? "æ¥ç¶šä¸­ï¼ˆOKï¼‰" : "æœªæ¥ç¶š";
  $("btnPreview").disabled = !filesReady() || !isAuthed();
  $("btnRun").disabled     = !filesReady() || !isAuthed();
}

function filesReady(){
  return $("fileSource").files.length && $("fileAnalytics").files.length;
}

function b64url(buf){
  return btoa(String.fromCharCode.apply(null,new Uint8Array(buf)))
       .replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");
}

async function sha256(str){
  const enc = new TextEncoder();
  const data = enc.encode(str);
  const digest = await crypto.subtle.digest("SHA-256",data);
  return b64url(digest);
}

function randomString(len=64){
  const p = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~";
  let out=""; for(let i=0;i<len;i++) out+=p[Math.floor(Math.random()*p.length)];
  return out;
}

async function startAuth(){
  const verifier = randomString(64);
  localStorage.setItem(LS.ver, verifier);
  const challenge = await sha256(verifier);
  const url = new URL("https://accounts.spotify.com/authorize");
  url.searchParams.set("response_type","code");
  url.searchParams.set("client_id", CLIENT_ID);
  url.searchParams.set("redirect_uri", REDIRECT_URI);
  url.searchParams.set("code_challenge_method","S256");
  url.searchParams.set("code_challenge", challenge);
  url.searchParams.set("scope", SCOPES);
  location.href = url.toString();
}

async function refreshTokenIfNeeded(){
  const exp = +localStorage.getItem(LS.exp||0);
  if (Date.now() < exp - 5000) return;

  const refresh_token = localStorage.getItem(LS.ref);
  if(!refresh_token) return;

  const body = new URLSearchParams({
    grant_type: "refresh_token",
    refresh_token,
    client_id: CLIENT_ID
  });

  const res = await fetch("https://accounts.spotify.com/api/token",{
    method:"POST",
    headers:{ "Content-Type":"application/x-www-form-urlencoded" },
    body
  });
  if(!res.ok){
    log("âš ï¸ refreshå¤±æ•—: "+res.status+" "+(await res.text()));
    return;
  }
  const j = await res.json();
  localStorage.setItem(LS.acc, j.access_token);
  localStorage.setItem(LS.exp, String(Date.now()+ (j.expires_in*1000)));
  if(j.refresh_token) localStorage.setItem(LS.ref, j.refresh_token);
  log("ğŸ”„ access_token refreshed");
}

async function spFetch(path, method="GET", body=null){
  await refreshTokenIfNeeded();
  const gap = +$("gap").value || 900;
  await new Promise(r=>setTimeout(r, gap));

  for(let attempt=0; attempt<5; attempt++){
    const res = await fetch("https://api.spotify.com"+path,{
      method,
      headers:{
        "Authorization":"Bearer "+localStorage.getItem(LS.acc),
        "Content-Type":"application/json"
      },
      body: body? JSON.stringify(body): null
    });

    if(res.status===401){ // token expiry
      await refreshTokenIfNeeded(); 
      continue;
    }
    if(res.status===429){
      const ra = +res.headers.get("Retry-After") || 2;
      log(`â³ 429 â†’ wait ${ra}s`);
      await new Promise(r=>setTimeout(r, ra*1000));
      continue;
    }
    if(!res.ok){
      const t = await res.text();
      throw new Error(`Spotify API error ${res.status}: ${t}`);
    }
    if(res.status===204) return null;
    return await res.json();
  }
  throw new Error("Spotify API max retries");
}

/* --------- ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ --------- */
let sourceRows = [];   // ã‚½ãƒ¼ã‚¹CSVï¼ˆæ¯é›†å›£ï¼‰
let analyticsRows = []; // åˆ†æãƒ‡ãƒ¼ã‚¿ï¼ˆCSV/XLSXï¼‰

function toText(file){ return new Promise((res,rej)=>{ const fr=new FileReader(); fr.onload=()=>res(fr.result); fr.onerror=rej; fr.readAsText(file); }); }
function readCSV(file){
  return new Promise((resolve,reject)=>{
    Papa.parse(file, {
      header:true, skipEmptyLines:true,
      complete: (r)=>resolve(r.data),
      error: reject
    });
  });
}
async function readXLSX(file){
  const data = await file.arrayBuffer();
  const wb = XLSX.read(data,{type:"array"});
  const sheet = wb.Sheets[wb.SheetNames[0]];
  return XLSX.utils.sheet_to_json(sheet,{defval:""});
}

function normName(s){ return String(s||"").trim().toLowerCase(); }
function truthy(v){
  const s = String(v).trim().toLowerCase();
  return ["1","true","yes","y","ok","âœ“","â—","â—¯","o"].includes(s);
}
function extractTrackId(any){
  const s = String(any||"").trim();
  if(!s) return "";
  // spotify:track:ID
  let m = s.match(/spotify:track:([A-Za-z0-9]{22})/); if(m) return m[1];
  // https://open.spotify.com/track/ID
  m = s.match(/open\.spotify\.com\/track\/([A-Za-z0-9]{22})/); if(m) return m[1];
  // è£¸ã®ID
  m = s.match(/^([A-Za-z0-9]{22})$/); if(m) return m[1];
  return "";
}
function extractPlaylistId(any){
  const s = String(any||"").trim();
  let m = s.match(/playlist\/([A-Za-z0-9]{22})/); if(m) return m[1];
  m = s.match(/^([A-Za-z0-9]{22})$/); if(m) return m[1];
  return "";
}

function findCol(obj, candidates){
  const keys = Object.keys(obj);
  for(const k of keys){
    const n = normName(k);
    for(const c of candidates){
      if(n===c) return k;
      if(n.includes(c)) return k;
    }
  }
  return null;
}

function prepareIndex(rows){
  const out = {};
  for(const r of rows){
    const idCol = findCol(r, ["spotify_uri","track_uri","uri","spotify_url","url","id"]);
    const id = extractTrackId(idCol? r[idCol] : "");
    if(!id) continue;
    out[id] = r;
  }
  return out;
}

async function loadFiles(){
  clearLog();
  log("ğŸ“¥ ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ä¸­â€¦");

  // ã‚½ãƒ¼ã‚¹
  sourceRows = await readCSV($("fileSource").files[0]);
  log(`âœ… ã‚½ãƒ¼ã‚¹CSV: ${sourceRows.length} è¡Œ`);
  // åˆ†æãƒ‡ãƒ¼ã‚¿
  const f2 = $("fileAnalytics").files[0];
  if(f2.name.toLowerCase().endsWith(".xlsx")){
    analyticsRows = await readXLSX(f2);
  }else{
    analyticsRows = await readCSV(f2);
  }
  log(`âœ… åˆ†æãƒ‡ãƒ¼ã‚¿: ${analyticsRows.length} è¡Œ`);

  $("btnPreview").disabled = !isAuthed();
  $("btnRun").disabled     = !isAuthed();
}

/* ---- ã‚¹ã‚³ã‚¢è¨ˆç®—ï¼ˆBalancedï¼‰ ---- */
function computeScores(){
  const srcIdx = prepareIndex(sourceRows);
  const rows   = [];
  // ã¾ãšåˆ†æãƒ‡ãƒ¼ã‚¿å´ã§ãƒˆãƒ©ãƒƒã‚¯IDæŠ½å‡ºã—ã€ã‚½ãƒ¼ã‚¹ã«å­˜åœ¨ã™ã‚‹ã‚‚ã®ã ã‘æ®‹ã™
  for(const r of analyticsRows){
    const idCol = findCol(r, ["spotify_uri","track_uri","uri","spotify_url","url","id"]);
    const id = extractTrackId(idCol? r[idCol] : "");
    if(!id) continue;
    if(!srcIdx[id]) continue; // ã‚½ãƒ¼ã‚¹ã«ç„¡ã„ â†’ æ¯é›†å›£å¤–
    rows.push({id, a:r, s:srcIdx[id]});
  }
  if(!rows.length) throw new Error("ä¸€è‡´ã™ã‚‹ãƒˆãƒ©ãƒƒã‚¯ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆURI/URL/IDã®åˆ—åã‚’ç¢ºèªï¼‰");

  // åˆ—åæ¨å®š
  const get = (obj, cands)=>{ const k = findCol(obj, cands); return k? obj[k]: null; };

  // æ­£è¦åŒ–ç”¨ã«playsã®æœ€å¤§å€¤ã‚’æ‹¾ã†
  const playsCols = [
    ["plays_24h","p24","streams24","play_24h"],
    ["plays_7d","p7","streams7","play_7d"],
    ["plays_28d","p28","streams28","play_28d"]
  ];
  const srCols = [
    ["save_rate_24h","sr24","save24"],
    ["save_rate_7d","sr7","save7"],
    ["save_rate_28d","sr28","save28"]
  ];

  const maxPlays = [0,0,0];
  for(const row of rows){
    const a = row.a;
    for(let i=0;i<3;i++){
      const k = get(a, playsCols[i]);
      const v = +String(k ?? 0).toString().replace(/[, %]/g,"");
      if(v>maxPlays[i]) maxPlays[i]=v;
    }
  }

  // ã‚¹ã‚³ã‚¢
  for(const row of rows){
    const a = row.a;
    const sr = [
      +String(get(a,srCols[0]) ?? 0).toString().replace(/[, %]/g,"")/100,
      +String(get(a,srCols[1]) ?? 0).toString().replace(/[, %]/g,"")/100,
      +String(get(a,srCols[2]) ?? 0).toString().replace(/[, %]/g,"")/100
    ];
    const pl = [
      +String(get(a,playsCols[0]) ?? 0).toString().replace(/[, %]/g,""),
      +String(get(a,playsCols[1]) ?? 0).toString().replace(/[, %]/g,""),
      +String(get(a,playsCols[2]) ?? 0).toString().replace(/[, %]/g,""),
    ];
    const plNorm = pl.map((v,i)=> maxPlays[i]? v/maxPlays[i] : 0);

    const newnessW = [0.5,0.3,0.2];
    const saveComp = newnessW[0]*sr[0] + newnessW[1]*sr[1] + newnessW[2]*sr[2];
    const playComp = newnessW[0]*plNorm[0] + newnessW[1]*plNorm[1] + newnessW[2]*plNorm[2];
    const wPop = +$("wPopularity").value || 0.55;
    const score = wPop*saveComp + (1-wPop)*playComp;

    // å¯ç”¨æ€§ã¨remixeråï¼ˆä»»æ„ï¼‰
    const uk = truthy(get(a,["uk","available_uk","avail_uk"]));
    const us = truthy(get(a,["us","available_us","avail_us"]));
    const eu = truthy(get(a,["eu","available_eu","avail_eu"]));
    const wo = truthy(get(a,["world","available_world","avail_world"]));
    const remixCol = get(a,["remixer","remixers","remixer_name"]);
    const remixer = remixCol? String(remixCol).trim() : (get(row.s,["remixer","remixers"])??"");

    row.score = score;
    row.flags = {uk,us,eu,wo};
    row.remixer = remixer;
  }

  // ã‚¹ã‚³ã‚¢é †
  rows.sort((a,b)=> b.score - a.score);
  return rows;
}

// é€£ç•ªãƒªãƒŸã‚­ã‚µãƒ¼å›é¿
function layoutNoAdjacent(list, maxN){
  const out=[]; const used=new Set();
  const lastByRemixer={};
  for(const item of list){
    if(out.length>=maxN) break;
    const r = (item.remixer||"").toLowerCase();
    if(out.length>0 && r && (out[out.length-1].remixer||"").toLowerCase()===r){
      // ã‚¹ã‚­ãƒƒãƒ—ã—ã¦å¾Œã§æ‹¾ã†
      continue;
    }
    out.push(item);
  }
  if(out.length<maxN){
    // è¶³ã‚Šãªã„åˆ†ã‚’æ®‹ã‚Šã‹ã‚‰å……å¡«ï¼ˆã‚„ã‚€ã‚’å¾—ãšé€£ç•ªè¨±å¯ï¼‰
    for(const item of list){
      if(out.length>=maxN) break;
      if(out.includes(item)) continue;
      out.push(item);
    }
  }
  return out;
}

function filterByEdition(rows, ed){
  // å¯ç”¨æ€§åˆ—ãŒå­˜åœ¨ã™ã‚‹å ´åˆã®ã¿ãƒ•ã‚£ãƒ«ã‚¿ã€‚ç„¡ã‘ã‚Œã°å…¨é€šã—ã€‚
  const hasAny = rows.some(r=> r.flags.uk || r.flags.us || r.flags.eu || r.flags.wo);
  if(!hasAny) return rows;
  const key = ed.toLowerCase();
  return rows.filter(r=> key==="world" ? (r.flags.wo || r.flags.uk || r.flags.us || r.flags.eu) : r.flags[key]);
}

function toUris(items){
  return items.map(x=> "spotify:track:"+x.id);
}

async function replacePlaylist(pid, uris){
  // Spotifyã¯ä¸€åº¦ã«100ä»¶ã¾ã§ã€‚æœ€åˆã¯PUTï¼ˆç½®æ›ï¼‰ã€ä»¥é™ã¯POSTï¼ˆè¿½åŠ ï¼‰ã€‚
  const chunks = [];
  for(let i=0;i<uris.length;i+=100) chunks.push(uris.slice(i,i+100));
  if(!chunks.length) chunks.push([]);
  await spFetch(`/v1/playlists/${pid}/tracks`, "PUT", {uris: chunks[0]});
  log(`ğŸ§¹ ç½®æ›: ${chunks[0].length}ä»¶`);
  for(let i=1;i<chunks.length;i++){
    await spFetch(`/v1/playlists/${pid}/tracks`, "POST", {uris: chunks[i]});
    log(`â• è¿½åŠ : ${chunks[i].length}ä»¶`);
  }
}

async function run(doPreview=false){
  try{
    clearLog();
    log("ğŸ” ã‚¹ã‚³ã‚¢è¨ˆç®—â€¦");
    const rows = computeScores();
    const balancedN = +$("balancedN").value || 150;
    const finalN    = +$("finalN").value || 130;

    const top = rows.slice(0, balancedN);

    const makeEdition = (name)=>{
      const filtered = filterByEdition(top, name);
      const placed   = layoutNoAdjacent(filtered, finalN);
      log(`â€¢ ${name}: å€™è£œ${filtered.length} â†’ å‡ºåŠ›${placed.length}`);
      return placed;
    };

    const edUK = makeEdition("UK");
    const edUS = makeEdition("US");
    const edEU = makeEdition("EU");
    const edWO = makeEdition("WORLD");

    if(doPreview){
      const preview = [...edUK.slice(0,5), ...edUS.slice(0,5), ...edEU.slice(0,5), ...edWO.slice(0,5)];
      log("ğŸ‘€ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆä¸Šä½20ãƒ»URIï¼‰\n"+toUris(preview).join("\n"));
      return;
    }

    if(!isAuthed()) throw new Error("Spotifyæœªæ¥ç¶šã§ã™ã€‚å…ˆã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã¦ãã ã•ã„ã€‚");

    const pidUK = extractPlaylistId($("plUK").value);
    const pidUS = extractPlaylistId($("plUS").value);
    const pidEU = extractPlaylistId($("plEU").value);
    const pidWO = extractPlaylistId($("plWORLD").value);
    if(!(pidUK&&pidUS&&pidEU&&pidWO)) throw new Error("ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆURL/IDãŒä¸æ­£ã§ã™ã€‚");

    log("ğŸš€ ä¸Šæ›¸ãé–‹å§‹â€¦ï¼ˆ429ãŒå‡ºãŸã‚‰è‡ªå‹•å¾…æ©Ÿï¼‰");
    await replacePlaylist(pidUK, toUris(edUK));
    await replacePlaylist(pidUS, toUris(edUS));
    await replacePlaylist(pidEU, toUris(edEU));
    await replacePlaylist(pidWO, toUris(edWO));
    log("âœ… å®Œäº†");
  }catch(e){
    log("ğŸ’¥ ERROR: "+ e.message);
    console.error(e);
  }
}

/* ---- ã‚¤ãƒ™ãƒ³ãƒˆ ---- */
$("btnConnect").onclick = startAuth;
$("btnReset").onclick = ()=>{
  Object.values(LS).forEach(k=> localStorage.removeItem(k));
  setStatus(); log("ğŸ§½ ãƒ­ãƒ¼ã‚«ãƒ«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å‰Šé™¤ã—ã¾ã—ãŸã€‚");
};
$("btnCheck").onclick = async ()=>{
  try{
    await refreshTokenIfNeeded();
    const me = await spFetch("/v1/me","GET");
    $("status").textContent = `æ¥ç¶šä¸­ï¼ˆ${me.display_name||me.id}ï¼‰`;
    log("âœ… APIç¢ºèª OK");
  }catch(e){
    log("âš ï¸ æ¥ç¶šã‚¨ãƒ©ãƒ¼: "+e.message);
  }
};
$("fileSource").addEventListener("change", loadFiles);
$("fileAnalytics").addEventListener("change", loadFiles);
$("btnPreview").onclick = ()=>run(true);
$("btnRun").onclick = ()=>run(false);

setStatus();
log("Ready. ã¾ãšSpotifyã«ã‚µã‚¤ãƒ³ã‚¤ãƒ³ã—ã€2ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚");
</script>
</body>
</html>
